---
layout: post
title: "领域驱动设计学习笔记"
categories: reading note
---

![领域驱动设计经典书籍](http://regulusun.github.io/images/ddd-book.jpg)

# 学习计划 
+ 《实现领域驱动设计》 && 《领域驱动设计精简版》
+ 读[Apche Isis User Guide](http://isis.apache.org/guides/ug.html) Core Concepts一节
+ 用DDD构建一个Demo

# 一些不错的DDD资源
+ [领域驱动设计和开发实战](http://www.infoq.com/cn/articles/ddd-in-practice)
+ [DDD eXchange skillscasts](https://skillsmatter.com/conferences/6453-ddd-exchange-2015#skillscasts)
+ [领域驱动设计实现之路](http://www.infoq.com/cn/articles/implementation-road-of-domain-driven-design?utm_source=infoq&utm_medium=related_content_link&utm_campaign=relatedContent_articles_clk)
+ [演进架构中的领域驱动设计](http://www.infoq.com/cn/articles/ddd-evolving-architecture)
+ [领域驱动设计参考架构详解](http://blog.csdn.net/bluishglc/article/details/6681253)
+ [Domain Event](http://martinfowler.com/eaaDev/DomainEvent.html)
+ [DDD Sample](http://dddsample.sourceforge.net/)

# 疑问  
> 带着疑问去学习，思考，能学习到更多；为什么有些书需要读好几遍，因为第一次读肯定没有多少针对性的疑问，除非你对这个领域有过大致的了解。没有问题，基本上可以说，你并没有思考

+ 领域对象如何迭代开发？
+ 实体与值对象的区别？为什么会有这种划分？
+ 领域服务与SOA中的服务是什么关系？两者如何结合？
+ 领域驱动设计中的聚合是什么？聚合有哪些特性或特征？
+ 领域驱动设计中的聚合可以用IOC/DI实例化么？为何引入工厂？
+ 子域与限界上下文有什么区别？
+ 如果说聚合根是外界唯一的访问入口，那么如何更新聚合中的实体对象？
+ 领域驱动设计中的资源库与DAO数据访问对象有什么区别？

<!-- DAO方法是细粒度的，更接近数据库，而资源库方法的粒度粗一些，而且更接近领域。此外，一个资源库类中能注入多个DAO。资源库和DAO能防止解耦的领域模型去处理数据访问和持久化细节 -->
+ 资源库与工厂同样都可以创建对象，资源库可以从持久化存储中恢复对象，那两者的使用场景有何区别？
+ 业务规则在DDD中处于怎样的位置，是否应放在业务领域对象之中？

<!-- 业务规则固然是业务领域的一部分，应放在领域对象DO中，但更好的做法，是把业务规则放到规则引擎中去维护 -->
+ 领域驱动设计与当前流行的失血Domain/DAO/Service相比较，有哪些优点？

<!-- 失血的领域对象，会导到肥服务层，业务边界模糊；而领域驱动设计，除了能为带个团队创建通用的语言进行沟通，最关键是的它真实的反映了业务的本质 -->
+ DDD中的聚合只是一些值对象、实体的组合么？  

<!-- 不一定，聚合一般是包含一些值对象和实体对象，但也有可能包含聚合 -->
+ RCP场景中，是否可以用DDD对象作传输对象呢？

<!-- DTO应只含有状态，所以DO领域对象不能当作DTO对象 -->
+ 领域对象依赖持久层是种错误的设计方法么？

<!-- 领域对象DO在领域驱动设计中，是需要依赖资源库的，又资源库又依赖持久层；领域对象具有数据与行为，而行为一般会和持久层打交道，所以DO必然会依赖持久层 -->
+ DDD可以应用于开发任何应用么？

<!-- DDD比较适合复杂的业务系统开发，对简单的应用系统，应用DDD反而使简单的事情变复杂了 -->

# 学习笔记
## 2015/7/6
### 接触之前对领域驱动设计的理解

  领域驱动设计目前就我所知，最重要的工作就是把业务中的概念抽象成领域对象，成为项目组成员中共同的语言；  
  目前所知的经验是要对业务非常深入的了解，然后尝试着成为**领域专家**（因为没有领域专家，开发者只能自己去成为领域专家）。

  另外一点，领域对象是**充血模型**的，与常见的[失血模型](http://martinfowler.com/bliki/AnemicDomainModel.html)+服务层不同，对象有数据和行为，把行为单独抽成service层中的接口或方法，感觉也是无耐之举，因为如果领域对象是充血模型的，那么领域对象势必会依赖持久化，感觉上这种依赖也是种坏味道（而这正是长期使用失血模型产生的错觉）。

> 对于业务开发人员来讲，要时常提醒自己的一句话是，“fool, problem is domain!”。深入理解领域的开发人员，即使使用过时技术所开发出来的软件，也远远好过完全不理解领域的开发人员，使用最时髦技术所开发出来的软件。  

## 2015/7/7
  我对编码的其中一个要求就是一个语义不要以多种单词的形式出现，很容易让人搞不清楚这个单词的具体意义。在领域驱动设计中，也有类似的场景，领域驱动设计中以模型为**通用语言**（UbiquitousLanguage），一个团队中讲相同的语言是相当重要的，信息能够对称；反之，软件专家使用自己的语言，领域专家也使用自己的语言，可以想象一下这种沟通的结果。  
  领域驱动设计是OOD的延续，面向对象太泛，使用不当，很容易成为双刃剑，迷失在对象关系中；我们需要引导，GOF的设计模式就是经验的结晶，DDD同样也是一种卓越的方法论。

## 2015/7/8
> 一个优秀的模型产生于深层的思考、理解、经验和天分。  

  从传统意义上讲，重构指的是出于技术动机的代码转换；重构的动机同样可以出于对领域的深入理解，以及对模型及代码表述进行相应的改进。  

  重构的前提是嗅到坏味道，对于领域驱动设计，其中一个坏味道是“设计变的不清晰或过程复杂到难以理解”，对于这种常见的坏味道，我们的经验是*寻找隐藏的概念*，因为产生这种坏味道的原因，很有可能是你在建立领域模型的时候遗漏了一些概念，导致了一些对象增加了一些本不应该属于它的行为。  
  坏味道是一个时机，同样如果领域专家之间的观点产生矛盾的时候，当你着手去解决矛盾时，也是一个发现重要概念的时机。  
  当然，挖掘模型概念最明显的还是领域文献。  

## 2015/7/9
  技术人员经常会讨论项目是否有技术含量，一般技术人员会从是否使用了高深或新颖的技术，又或巧妙的算法而去论断，我以前也是这么认为的，现在变了，当然那些还是有技术含量的，只是地位不再是第一了。现在我认为对复杂业务建立恰当好处的领域模型、子域（think about 淘宝五彩石项目）、限界上下文等等，才是至关重要的，才是最具技术含量的工作，是你对面向对象思想的理解的考验。  
  领域建模、设计往往需要花一些额外的时间，但要让它产生效果，又得花一个很长的周期（看起来没多大好处么），短期内你是看不出来这个领域模型是对的还是错的，只有随着业务的不断发展，你才能看到当时的设计的效果；这不同于一般的有技术含量的项目，那些项目你只要运行一次或很短的时间，你就能看到效果；而这也正映射了领域建模的难度之高。

## 2015/8/5
  聚合表达了与事务一致性边界相同的意思，聚合边界之内的所有内容（对象）组成了一套不变的业务规则。所以一般情况下，只有聚合才有相应的资源库。
  如果你设计了一个大聚合，这可能是一种臭味道，你需要警惕大聚合；大聚合在性能与可伸缩性上不如小聚合好，事务可用性亦如此。 
## 2015/8/10
  在RCP场景中，是否可以用DDD对象作为传输对象，又或者是否可以把DDD对象暴露给消费者？  
  DDD作为传输对象似乎不合理，应该设计专门的DTO对象更合理点；同理，DDD对象也不应该暴露给消费者，因为DDD对象中含有业务逻辑，不应该暴露给消费者；数据传输对象应该只包含状态。
## 2015/8/11
  > Refactor your ubiquitous language 1st, your code 2nd.  

  什么时候用DDD？标准答案是你的业务足够复杂的时候，怎么去衡量你的业务复杂度，这可能需要根据你的经验或感觉。  

# 玄难大师对领域建模的理解
  + 业务模型是用面向对象的思想对现实的抽象，结果是相对稳定的；重点包括：干系人角色（信息与行为）、业务实体（信息与行为）、角色间的关系、实体间的关系、角色和实体间的关系
  + 模型要能真实反应事物的本质，是现实的映射
  + 业务模型和存储模型是两个区别很大的概念，不能混为一体。存储模型只是为了方便信息的持久化
  + 抽象和枚举是两种方式，需要平衡，不能走极端（反例：抽象过度，全部是Object）
  + 领域建模没有绝对的对错，需要不断反思，是一个动态优化的过程
  + **领域建模是艺术**
    
# 总结
  领域驱动设计不是一种架构，而是面向对象的升级，是一种软件开发方法。  
  领域建模非常难，需要不断的优化反思，但我们也可以获得不少好处，小模块，松耦合，易测试，清晰的业务概念，团队通用的语言等等。  
  对于业务开发人员，领域建模的水平是其核心竞争力，是每个业务开发人员**必须精通**的一门艺术。

注：一些疑问的答案在网页的源代码中
